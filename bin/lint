#!/usr/bin/env node

var fs = require('fs');
var util = require('util');
var inspect = util.inspect;
var program = require('commander');

var linter = require('..');
var linterReport = require('../lib/linterReport');

program
    .version(require('../package.json').version)
    .option('--lint', 'Linter-compatible output')
    .usage('<file ...>')
    .parse(process.argv);

var filepath = program.args[0];

if (typeof filepath === 'string') {
    try {
        linter(
            fs.readFileSync(filepath, 'utf8'),
            function(report) {
                if (program.lint) {
                    console.log(
                        linterReport(report, filepath)
                    );
                } else {
                    console.log(
                        inspect(report, { colors: true, depth: Infinity })
                    );
                }
            }
        );
    } catch(e) {
        printError('problem reading ' + filepath, e);
    }
} else {
    printError('no file to lint');
}

function printError(message, error) {
    console.log('');
    console.log('  error: ' + message);

    if (error) {
        console.log('');
        console.log('  ' + error.toString());
    }

    console.log('');
}
