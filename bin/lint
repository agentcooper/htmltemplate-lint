#!/usr/bin/env node

var fs = require('fs');
var inspect = require('util').inspect;
var program = require('commander');

var linter = require('..');

program
    .version(require('../package.json').version)
    .usage('<file ...>')
    .parse(process.argv);

var filepath = program.args[0];

if (typeof filepath === 'string') {
    try {
        linter(
            fs.readFileSync(filepath, 'utf8'),
            function(report) {
                console.log(
                    inspect(report, { colors: true, depth: Infinity })
                );
            }
        );
    } catch(e) {
        printError('problem reading ' + filepath, e);
    }
} else {
    printError('no file to lint');
}

function printError(message, error) {
    console.log('');
    console.log('  error: ' + message);

    if (error) {
        console.log('');
        console.log('  ' + error.toString());
    }

    console.log('');
}
